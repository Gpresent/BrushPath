import { SVGTransform } from './SVGTransform.js';
import { degToRads, isNullOrUndefined, rotatePoint } from './utils.js';
// Calculators
// https://pomax.github.io/bezierinfo/
function calculateLinear(t, p1, p2) {
    return p1 + t * (p2 - p1);
}
function calculatePointQuadratic(t, p1, p2, p3) {
    const oneMinusT = 1 - t;
    return (oneMinusT * oneMinusT) * p1 + 2 * oneMinusT * t * p2 + (t * t) * p3;
}
function calculatePointCubic(t, p1, p2, p3, p4) {
    const t2 = t * t;
    const t3 = t2 * t;
    const oneMinusT = 1 - t;
    return p1 * Math.pow(oneMinusT, 3) + p2 * 3 * (oneMinusT * oneMinusT) * t + p3 * 3 * oneMinusT * t2 + p4 * t3;
}
function calculateCoordinatesLinear(points, minDistance, roundToNearest, sampleFrequency) {
    const pts = [];
    let [startX, startY] = points.splice(0, 2);
    for (let i = 0; i < points.length; i += 2) {
        let endX = points[i];
        let endY = points[i + 1];
        let t = 0;
        let lastX = startX;
        let lastY = startY;
        while (t <= 1.0000000000000007) {
            const x = calculateLinear(t, startX, endX);
            const y = calculateLinear(t, startY, endY);
            const deltaX = x - lastX;
            const deltaY = y - lastY;
            const dist = Math.sqrt((deltaX * deltaX) + (deltaY * deltaY));
            if (Math.abs(dist) > minDistance) {
                pts.push(x - (x % roundToNearest), y - (y % roundToNearest));
                lastX = x;
                lastY = y;
            }
            t += sampleFrequency;
        }
        startX = endX;
        startY = endY;
    }
    return pts;
}
function calculateCoordinatesQuad(points, minDistance, roundToNearest, sampleFrequency) {
    const pts = [];
    let [startX, startY] = points.splice(0, 2);
    for (let i = 0; i < points.length; i += 4) {
        let ctrl1x = points[i];
        let ctrl1y = points[i + 1];
        let endX = points[i + 2];
        let endY = points[i + 3];
        let t = 0;
        let lastX = startX;
        let lastY = startY;
        while (t <= 1.0000000000000007) {
            const x = calculatePointQuadratic(t, startX, ctrl1x, endX);
            const y = calculatePointQuadratic(t, startY, ctrl1y, endY);
            const deltaX = x - lastX;
            const deltaY = y - lastY;
            const dist = Math.sqrt((deltaX * deltaX) + (deltaY * deltaY));
            if (Math.abs(dist) > minDistance) {
                pts.push(x - (x % roundToNearest), y - (y % roundToNearest));
                lastX = x;
                lastY = y;
            }
            t += sampleFrequency;
        }
        startX = endX;
        startY = endY;
    }
    return pts;
}
function calculateCoordinatesCubic(points, minDistance, roundToNearest, sampleFrequency) {
    const pts = [];
    let [startX, startY] = points.splice(0, 2);
    for (let i = 0; i < points.length; i += 6) {
        let ctrl1x = points[i];
        let ctrl1y = points[i + 1];
        let ctrl2x = points[i + 2];
        let ctrl2y = points[i + 3];
        let endX = points[i + 4];
        let endY = points[i + 5];
        let t = 0;
        let lastX = startX;
        let lastY = startY;
        while (t <= 1.0000000000000007) {
            const x = calculatePointCubic(t, startX, ctrl1x, ctrl2x, endX);
            const y = calculatePointCubic(t, startY, ctrl1y, ctrl2y, endY);
            const deltaX = x - lastX;
            const deltaY = y - lastY;
            const dist = Math.sqrt((deltaX * deltaX) + (deltaY * deltaY));
            if (Math.abs(dist) > minDistance) {
                pts.push(x - (x % roundToNearest), y - (y % roundToNearest));
                lastX = x;
                lastY = y;
            }
            t += sampleFrequency;
        }
        startX = endX;
        startY = endY;
    }
    return pts;
}
function calculateCoordinatesSmoothCubic(points, minDistance, roundToNearest, sampleFrequency) {
    const pts = [];
    let [startX, startY, previousCtrl2x, previousCtrl2y] = points.splice(0, 4);
    for (let i = 0; i < points.length; i += 4) {
        const ctrl2x = points[i];
        const ctrl2y = points[i + 1];
        const endX = points[i + 2];
        const endY = points[i + 3];
        if (isNullOrUndefined(previousCtrl2x) || isNullOrUndefined(previousCtrl2y)) {
            previousCtrl2x = startX;
            previousCtrl2y = startY;
        }
        let svgTransform = new SVGTransform(1, 0, 0, 1, previousCtrl2x - startX, previousCtrl2y - startY).inverse();
        let { x: ctrl1x, y: ctrl1y } = svgTransform.map(startX, startY);
        const interpolatedPts = calculateCoordinatesCubic([startX, startY, ctrl1x, ctrl1y, ctrl2x, ctrl2y, endX, endY], minDistance, roundToNearest, sampleFrequency);
        pts.push(...interpolatedPts);
        startX = endX;
        startY = endY;
        previousCtrl2x = ctrl2x;
        previousCtrl2y = ctrl2y;
    }
    return pts;
}
function calculateCoordinatesArc(points, minDistance, roundToNearest, sampleFrequency) {
    const pts = [];
    let [startX, startY] = points.splice(0, 2);
    for (let i = 0; i < points.length; i += 7) {
        let rx = points[i];
        let ry = points[i + 1];
        let angle = points[i + 2];
        let largeArc = points[i + 3];
        let sweep = points[i + 4];
        let endX = points[i + 5];
        let endY = points[i + 6];
        // If the endpoints (x1, y1) and (x2, y2) are identical, then
        // this is equivalent to omitting the elliptical arc segment entirely.
        if (startX === endX && startY === endY) {
            continue;
        }
        // If rx = 0 or ry = 0 then this arc is treated as a straight
        // line segment (a "lineto") joining the endpoints.
        if (rx === 0 || ry === 0) {
            pts.push(...calculateCoordinatesLinear([startX, startY, endX, endY], minDistance, roundToNearest, sampleFrequency));
            continue;
        }
        // If rx or ry have negative signs, these are dropped;
        // the absolute value is used instead.
        if (rx < 0) {
            rx *= -1;
        }
        if (ry < 0) {
            ry *= -1;
        }
        const beziers = decomposeArcToCubic({ x: startX, y: startY }, angle, rx, ry, largeArc, sweep, { x: endX, y: endY });
        // Triplet points - start of new bezier is end of last
        for (let i = 0; i < beziers.length; i += 3) {
            const ctrlPt1 = beziers[i];
            const ctrlPt2 = beziers[i + 1];
            const endPoint = beziers[i + 2];
            const points = [startX, startY, ctrlPt1.x, ctrlPt1.y, ctrlPt2.x, ctrlPt2.y, endPoint.x, endPoint.y];
            const interpolatedPoints = calculateCoordinatesCubic(points, minDistance, roundToNearest, sampleFrequency);
            pts.push(...interpolatedPoints);
            startX = endPoint.x;
            startY = endPoint.y;
        }
        startX = endX;
        startY = endY;
    }
    return pts;
}
function decomposeArcToCubic(point1, rotationInDegrees, rx, ry, largeArcFlag, sweepFlag, point2) {
    //----------------------------
    // https://github.com/WebKit/webkit/blob/master/Source/WebCore/svg/SVGPathParser.cpp
    //----------------------------
    // Conversion from endpoint to center parameterization
    // https://www.w3.org/TR/SVG/implnote.html#ArcConversionEndpointToCenter
    const angleRads = degToRads(rotationInDegrees);
    const midPointDistance = { x: (point1.x - point2.x) * .5, y: (point1.y - point2.y) * .5 };
    const transformedMidPoint = rotatePoint(0, 0, midPointDistance.x, midPointDistance.y, -angleRads, -angleRads);
    const squareRx = rx * rx;
    const squareRy = ry * ry;
    const squareX = transformedMidPoint.x * transformedMidPoint.x;
    const squareY = transformedMidPoint.y * transformedMidPoint.y;
    // Check if the radii are big enough to draw the arc, scale radii if not.
    // http://www.w3.org/TR/SVG/implnote.html#ArcCorrectionOutOfRangeRadii
    const radiiScale = squareX / squareRx + squareY / squareRy;
    if (radiiScale > 1) {
        const sqrtRadiiScale = Math.sqrt(radiiScale);
        rx *= sqrtRadiiScale;
        ry *= sqrtRadiiScale;
    }
    // Apply scale
    point1 = { x: point1.x * (1 / rx), y: point1.y * (1 / ry) };
    point2 = { x: point2.x * (1 / rx), y: point2.y * (1 / ry) };
    // Apply rotation
    point1 = rotatePoint(0, 0, point1.x, point1.y, -angleRads, -angleRads);
    point2 = rotatePoint(0, 0, point2.x, point2.y, -angleRads, -angleRads);
    const delta = { x: point2.x - point1.x, y: point2.y - point1.y };
    const d = delta.x * delta.x + delta.y * delta.y;
    const scaleFactorSquared = Math.max(1 / d - 0.25, 0);
    let scaleFactor = Math.sqrt(scaleFactorSquared);
    if (sweepFlag === largeArcFlag) {
        scaleFactor = -scaleFactor;
    }
    delta.x *= scaleFactor;
    delta.y *= scaleFactor;
    let centerPoint = { x: (point1.x + point2.x) * .5, y: (point1.y + point2.y) * .5 };
    // https://github.com/WebKit/webkit/blob/master/Source/WebCore/svg/SVGPathParser.cpp#L465
    centerPoint.x -= delta.y;
    centerPoint.y += delta.x;
    const theta1 = Math.atan2(point1.y - centerPoint.y, point1.x - centerPoint.x);
    const theta2 = Math.atan2(point2.y - centerPoint.y, point2.x - centerPoint.x);
    let thetaArc = theta2 - theta1;
    if (thetaArc < 0 && sweepFlag)
        thetaArc += 2 * Math.PI;
    else if (thetaArc > 0 && !sweepFlag)
        thetaArc -= 2 * Math.PI;
    // Some results of atan2 on some platform implementations are not exact enough. So that we get more
    // cubic curves than expected here. Adding 0.001f reduces the count of segments to the correct count.
    const cubicBeziers = []; // Triplet points - Assumes the start point is the end point from the previous command
    const segments = Math.ceil(Math.abs(thetaArc / ((Math.PI / 2) + 0.001)));
    for (let i = 0; i < segments; i++) {
        const startTheta = theta1 + i * thetaArc / segments;
        const endTheta = theta1 + (i + 1) * thetaArc / segments;
        const t = (8 / 6) * Math.tan(0.25 * (endTheta - startTheta));
        if (!isFinite(t)) {
            return [];
        }
        const sinStartTheta = Math.sin(startTheta);
        const cosStartTheta = Math.cos(startTheta);
        const sinEndTheta = Math.sin(endTheta);
        const cosEndTheta = Math.cos(endTheta);
        point1 = { x: cosStartTheta - t * sinStartTheta, y: sinStartTheta + t * cosStartTheta };
        point1.x += centerPoint.x;
        point1.y += centerPoint.y;
        let targetPoint = { x: cosEndTheta, y: sinEndTheta };
        targetPoint.x += centerPoint.x;
        targetPoint.y += centerPoint.y;
        point2 = Object.assign({}, targetPoint);
        point2.x += t * sinEndTheta;
        point2.y += -t * cosEndTheta;
        // rotate and scale
        point1 = rotatePoint(0, 0, point1.x, point1.y, angleRads, angleRads);
        point1.x *= rx;
        point1.y *= ry;
        point2 = rotatePoint(0, 0, point2.x, point2.y, angleRads, angleRads);
        point2.x *= rx;
        point2.y *= ry;
        targetPoint = rotatePoint(0, 0, targetPoint.x, targetPoint.y, angleRads, angleRads);
        targetPoint.x *= rx;
        targetPoint.y *= ry;
        cubicBeziers.push(point1, point2, targetPoint);
    }
    return cubicBeziers;
}
export const calculators = {
    a: calculateCoordinatesArc,
    c: calculateCoordinatesCubic,
    h: calculateCoordinatesLinear,
    l: calculateCoordinatesLinear,
    m: calculateCoordinatesLinear,
    q: calculateCoordinatesQuad,
    s: calculateCoordinatesSmoothCubic,
    v: calculateCoordinatesLinear,
    z: calculateCoordinatesLinear
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsY3VsYXRvcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWF0aC9jYWxjdWxhdG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxXQUFXLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFPdkUsY0FBYztBQUNkLHNDQUFzQztBQUN0QyxTQUFTLGVBQWUsQ0FBQyxDQUFTLEVBQUUsRUFBVSxFQUFFLEVBQVU7SUFDeEQsT0FBTyxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFFRCxTQUFTLHVCQUF1QixDQUFDLENBQVMsRUFBRSxFQUFVLEVBQUUsRUFBVSxFQUFFLEVBQVU7SUFDNUUsTUFBTSxTQUFTLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN4QixPQUFPLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsU0FBUyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQzlFLENBQUM7QUFFRCxTQUFTLG1CQUFtQixDQUFDLENBQVMsRUFBRSxFQUFVLEVBQUUsRUFBVSxFQUFFLEVBQVUsRUFBRSxFQUFVO0lBQ3BGLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakIsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNsQixNQUFNLFNBQVMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRXhCLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsU0FB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QztRQUNyQixFQUFFLElBQUksY0FBYyxDQUFDO0tBQ3RCO0lBQ0QsY0FBYztJQUNkLE1BQU0sR0FBRyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUM7SUFDNUQsTUFBTSxHQUFHLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQztJQUM1RCxpQkFBaUI7SUFDakIsTUFBTSxHQUFHLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3ZFLE1BQU0sR0FBRyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUV2RSxNQUFNLEtBQUssR0FBRyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ2pFLE1BQU0sQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDaEQsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMs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QUFFLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ3BGLFdBQVcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3BCLFdBQVcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBRXBCLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztLQUNoRDtJQUNELE9BQU8sWUFBcUMsQ0FBQztBQUMvQyxDQUFDO0FBRUQsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHO0lBQ3pCLENBQUMsRUFBRSx1QkFBdUI7SUFDMUIsQ0FBQyxFQUFFLHlCQUF5QjtJQUM1QixDQUFDLEVBQUUsMEJBQTBCO0lBQzdCLENBQUMsRUFBRSwwQkFBMEI7SUFDN0IsQ0FBQyxFQUFFLDBCQUEwQjtJQUM3QixDQUFDLEVBQUUsd0JBQXdCO0lBQzNCLENBQUMsRUFBRSwrQkFBK0I7SUFDbEMsQ0FBQyxFQUFFLDBCQUEwQjtJQUM3QixDQUFDLEVBQUUsMEJBQTBCO0NBQzlCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTVkdUcmFuc2Zvcm0gfSBmcm9tICcuL1NWR1RyYW5zZm9ybS5qcyc7XG5pbXBvcnQgeyBkZWdUb1JhZHMsIGlzTnVsbE9yVW5kZWZpbmVkLCByb3RhdGVQb2ludCB9IGZyb20gJy4vdXRpbHMuanMnO1xuXG5leHBvcnQgdHlwZSBQb2ludCA9IHtcbiAgeDogbnVtYmVyO1xuICB5OiBudW1iZXI7XG59XG5cbi8vIENhbGN1bGF0b3JzXG4vLyBodHRwczovL3BvbWF4LmdpdGh1Yi5pby9iZXppZXJpbmZvL1xuZnVuY3Rpb24gY2FsY3VsYXRlTGluZWFyKHQ6IG51bWJlciwgcDE6IG51bWJlciwgcDI6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiBwMSArIHQgKiAocDIgLSBwMSk7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVBvaW50UXVhZHJhdGljKHQ6IG51bWJlciwgcDE6IG51bWJlciwgcDI6IG51bWJlciwgcDM6IG51bWJlcik6IG51bWJlciB7XG4gIGNvbnN0IG9uZU1pbnVzVCA9IDEgLSB0O1xuICByZXR1cm4gKG9uZU1pbnVzVCAqIG9uZU1pbnVzVCkgKiBwMSArIDIgKiBvbmVNaW51c1QgKiB0ICogcDIgKyAodCAqIHQpICogcDM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVBvaW50Q3ViaWModDogbnVtYmVyLCBwMTogbnVtYmVyLCBwMjogbnVtYmVyLCBwMzogbnVtYmVyLCBwNDogbnVtYmVyKTogbnVtYmVyIHtcbiAgY29uc3QgdDIgPSB0ICogdDtcbiAgY29uc3QgdDMgPSB0MiAqIHQ7XG4gIGNvbnN0IG9uZU1pbnVzVCA9IDEgLSB0O1xuXG4gIHJldHVybiBwMSAqIE1hdGgucG93KG9uZU1pbnVzVCwgMykgKyBwMiAqIDMgKiAob25lTWludXNUICogb25lTWludXNUKSAqIHQgKyBwMyAqIDMgKiBvbmVNaW51c1QgKiB0MiArIHA0ICogdDM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUNvb3JkaW5hdGVzTGluZWFyKHBvaW50czogbnVtYmVyW10sIG1pbkRpc3RhbmNlOiBudW1iZXIsIHJvdW5kVG9OZWFyZXN0OiBudW1iZXIsIHNhbXBsZUZyZXF1ZW5jeTogbnVtYmVyKTogbnVtYmVyW10ge1xuICBjb25zdCBwdHMgPSBbXTtcbiAgbGV0IFsgc3RhcnRYLCBzdGFydFkgXSA9IHBvaW50cy5zcGxpY2UoMCwgMik7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2ludHMubGVuZ3RoOyBpICs9IDIpIHtcbiAgICBsZXQgZW5kWCA9IHBvaW50c1tpXTtcbiAgICBsZXQgZW5kWSA9IHBvaW50c1tpICsgMV07XG4gICAgbGV0IHQgPSAwO1xuICAgIGxldCBsYXN0WCA9IHN0YXJ0WDtcbiAgICBsZXQgbGFzdFkgPSBzdGFydFk7XG4gICAgd2hpbGUgKHQgPD0gMS4wMDAwMDAwMDAwMDAwMDA3KSB7XG4gICAgICBjb25zdCB4ID0gY2FsY3VsYXRlTGluZWFyKHQsIHN0YXJ0WCwgZW5kWCk7XG4gICAgICBjb25zdCB5ID0gY2FsY3VsYXRlTGluZWFyKHQsIHN0YXJ0WSwgZW5kWSk7XG5cbiAgICAgIGNvbnN0IGRlbHRhWCA9IHggLSBsYXN0WDtcbiAgICAgIGNvbnN0IGRlbHRhWSA9IHkgLSBsYXN0WTtcbiAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoKGRlbHRhWCAqIGRlbHRhWCkgKyAoZGVsdGFZICogZGVsdGFZKSk7XG4gICAgICBpZiAoTWF0aC5hYnMoZGlzdCkgPiBtaW5EaXN0YW5jZSkge1xuICAgICAgICBwdHMucHVzaCh4IC0gKHggJSByb3VuZFRvTmVhcmVzdCksIHkgLSAoeSAlIHJvdW5kVG9OZWFyZXN0KSk7XG4gICAgICAgIGxhc3RYID0geDtcbiAgICAgICAgbGFzdFkgPSB5O1xuICAgICAgfVxuICAgICAgdCArPSBzYW1wbGVGcmVxdWVuY3lcbiAgICB9XG4gICAgc3RhcnRYID0gZW5kWDtcbiAgICBzdGFydFkgPSBlbmRZO1xuICB9XG4gIHJldHVybiBwdHM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUNvb3JkaW5hdGVzUXVhZChwb2ludHM6IG51bWJlcltdLCBtaW5EaXN0YW5jZTogbnVtYmVyLCByb3VuZFRvTmVhcmVzdDogbnVtYmVyLCBzYW1wbGVGcmVxdWVuY3k6IG51bWJlcik6IG51bWJlcltdIHtcbiAgY29uc3QgcHRzID0gW107XG4gIGxldCBbIHN0YXJ0WCwgc3RhcnRZIF0gPSBwb2ludHMuc3BsaWNlKDAsIDIpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgbGV0IGN0cmwxeCA9IHBvaW50c1tpXTtcbiAgICBsZXQgY3RybDF5ID0gcG9pbnRzW2kgKyAxXTtcbiAgICBsZXQgZW5kWCA9IHBvaW50c1tpICsgMl07XG4gICAgbGV0IGVuZFkgPSBwb2ludHNbaSArIDNdO1xuXG4gICAgbGV0IHQgPSAwO1xuICAgIGxldCBsYXN0WCA9IHN0YXJ0WDtcbiAgICBsZXQgbGFzdFkgPSBzdGFydFk7XG4gICAgd2hpbGUgKHQgPD0gMS4wMDAwMDAwMDAwMDAwMDA3KSB7XG4gICAgICBjb25zdCB4ID0gY2FsY3VsYXRlUG9pbnRRdWFkcmF0aWModCwgc3RhcnRYLCBjdHJsMXgsIGVuZFgpO1xuICAgICAgY29uc3QgeSA9IGNhbGN1bGF0ZVBvaW50UXVhZHJhdGljKHQsIHN0YXJ0WSwgY3RybDF5LCBlbmRZKTtcblxuICAgICAgY29uc3QgZGVsdGFYID0geCAtIGxhc3RYO1xuICAgICAgY29uc3QgZGVsdGFZID0geSAtIGxhc3RZO1xuICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydCgoZGVsdGFYICogZGVsdGFYKSArIChkZWx0YVkgKiBkZWx0YVkpKTtcbiAgICAgIGlmIChNYXRoLmFicyhkaXN0KSA+IG1pbkRpc3RhbmNlKSB7XG4gICAgICAgIHB0cy5wdXNoKHggLSAoeCAlIHJvdW5kVG9OZWFyZXN0KSwgeSAtICh5ICUgcm91bmRUb05lYXJlc3QpKTtcbiAgICAgICAgbGFzdFggPSB4O1xuICAgICAgICBsYXN0WSA9IHk7XG4gICAgICB9XG4gICAgICB0ICs9IHNhbXBsZUZyZXF1ZW5jeTtcbiAgICB9XG4gICAgc3RhcnRYID0gZW5kWDtcbiAgICBzdGFydFkgPSBlbmRZO1xuICB9XG5cbiAgcmV0dXJuIHB0cztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlQ29vcmRpbmF0ZXNDdWJpYyhwb2ludHM6IG51bWJlcltdLCBtaW5EaXN0YW5jZTogbnVtYmVyLCByb3VuZFRvTmVhcmVzdDogbnVtYmVyLCBzYW1wbGVGcmVxdWVuY3k6IG51bWJlcik6IG51bWJlcltdIHtcbiAgY29uc3QgcHRzID0gW107XG4gIGxldCBbIHN0YXJ0WCwgc3RhcnRZIF0gPSBwb2ludHMuc3BsaWNlKDAsIDIpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSArPSA2KSB7XG4gICAgbGV0IGN0cmwxeCA9IHBvaW50c1tpXTtcbiAgICBsZXQgY3RybDF5ID0gcG9pbnRzW2kgKyAxXTtcbiAgICBsZXQgY3RybDJ4ID0gcG9pbnRzW2kgKyAyXTtcbiAgICBsZXQgY3RybDJ5ID0gcG9pbnRzW2kgKyAzXTtcbiAgICBsZXQgZW5kWCA9IHBvaW50c1tpICsgNF07XG4gICAgbGV0IGVuZFkgPSBwb2ludHNbaSArIDVdO1xuICAgIGxldCB0ID0gMDtcbiAgICBsZXQgbGFzdFggPSBzdGFydFg7XG4gICAgbGV0IGxhc3RZID0gc3RhcnRZO1xuICAgIHdoaWxlICh0IDw9IDEuMDAwMDAwMDAwMDAwMDAwNykge1xuICAgICAgY29uc3QgeCA9IGNhbGN1bGF0ZVBvaW50Q3ViaWModCwgc3RhcnRYLCBjdHJsMXgsIGN0cmwyeCwgZW5kWCk7XG4gICAgICBjb25zdCB5ID0gY2FsY3VsYXRlUG9pbnRDdWJpYyh0LCBzdGFydFksIGN0cmwxeSwgY3RybDJ5LCBlbmRZKTtcblxuICAgICAgY29uc3QgZGVsdGFYID0geCAtIGxhc3RYO1xuICAgICAgY29uc3QgZGVsdGFZID0geSAtIGxhc3RZO1xuICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydCgoZGVsdGFYICogZGVsdGFYKSArIChkZWx0YVkgKiBkZWx0YVkpKTtcbiAgICAgIGlmIChNYXRoLmFicyhkaXN0KSA+IG1pbkRpc3RhbmNlKSB7XG4gICAgICAgIHB0cy5wdXNoKHggLSAoeCAlIHJvdW5kVG9OZWFyZXN0KSwgeSAtICh5ICUgcm91bmRUb05lYXJlc3QpKTtcbiAgICAgICAgbGFzdFggPSB4O1xuICAgICAgICBsYXN0WSA9IHk7XG4gICAgICB9XG4gICAgICB0ICs9IHNhbXBsZUZyZXF1ZW5jeTtcbiAgICB9XG4gICAgc3RhcnRYID0gZW5kWDtcbiAgICBzdGFydFkgPSBlbmRZO1xuICB9XG5cbiAgcmV0dXJuIHB0cztcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlQ29vcmRpbmF0ZXNTbW9vdGhDdWJpYyhwb2ludHM6IG51bWJlcltdLCBtaW5EaXN0YW5jZTogbnVtYmVyLCByb3VuZFRvTmVhcmVzdDogbnVtYmVyLCBzYW1wbGVGcmVxdWVuY3k6IG51bWJlcik6IG51bWJlcltdIHtcbiAgY29uc3QgcHRzID0gW107XG4gIGxldCBbIHN0YXJ0WCwgc3RhcnRZLCBwcmV2aW91c0N0cmwyeCwgcHJldmlvdXNDdHJsMnkgXSA9IHBvaW50cy5zcGxpY2UoMCwgNCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2ludHMubGVuZ3RoOyBpICs9IDQpIHtcbiAgICBjb25zdCBjdHJsMnggPSBwb2ludHNbaV07XG4gICAgY29uc3QgY3RybDJ5ID0gcG9pbnRzW2kgKyAxXTtcbiAgICBjb25zdCBlbmRYID0gcG9pbnRzW2kgKyAyXTtcbiAgICBjb25zdCBlbmRZID0gcG9pbnRzW2kgKyAzXTtcbiAgICBpZiAoaXNOdWxsT3JVbmRlZmluZWQocHJldmlvdXNDdHJsMngpIHx8IGlzTnVsbE9yVW5kZWZpbmVkKHByZXZpb3VzQ3RybDJ5KSkge1xuICAgICAgcHJldmlvdXNDdHJsMnggPSBzdGFydFg7XG4gICAgICBwcmV2aW91c0N0cmwyeSA9IHN0YXJ0WTtcbiAgICB9XG5cbiAgICBsZXQgc3ZnVHJhbnNmb3JtID0gbmV3IFNWR1RyYW5zZm9ybSgxLCAwLCAwLCAxLCBwcmV2aW91c0N0cmwyeCAtIHN0YXJ0WCwgcHJldmlvdXNDdHJsMnkgLSBzdGFydFkpLmludmVyc2UoKTtcbiAgICBsZXQgeyB4OiBjdHJsMXgsIHk6IGN0cmwxeSB9ID0gc3ZnVHJhbnNmb3JtLm1hcChzdGFydFgsIHN0YXJ0WSk7XG5cbiAgICBjb25zdCBpbnRlcnBvbGF0ZWRQdHMgPSBjYWxjdWxhdGVDb29yZGluYXRlc0N1YmljKFsgc3RhcnRYLCBzdGFydFksIGN0cmwxeCwgY3RybDF5LCBjdHJsMngsIGN0cmwyeSwgZW5kWCwgZW5kWSBdLCBtaW5EaXN0YW5jZSwgcm91bmRUb05lYXJlc3QsIHNhbXBsZUZyZXF1ZW5jeSk7XG4gICAgcHRzLnB1c2goLi4uaW50ZXJwb2xhdGVkUHRzKTtcblxuICAgIHN0YXJ0WCA9IGVuZFg7XG4gICAgc3RhcnRZID0gZW5kWTtcbiAgICBwcmV2aW91c0N0cmwyeCA9IGN0cmwyeDtcbiAgICBwcmV2aW91c0N0cmwyeSA9IGN0cmwyeTtcbiAgfVxuICByZXR1cm4gcHRzO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVDb29yZGluYXRlc0FyYyhwb2ludHM6IG51bWJlcltdLCBtaW5EaXN0YW5jZTogbnVtYmVyLCByb3VuZFRvTmVhcmVzdDogbnVtYmVyLCBzYW1wbGVGcmVxdWVuY3k6IG51bWJlcik6IG51bWJlcltdIHtcbiAgY29uc3QgcHRzID0gW107XG4gIGxldCBbIHN0YXJ0WCwgc3RhcnRZIF0gPSBwb2ludHMuc3BsaWNlKDAsIDIpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSArPSA3KSB7XG4gICAgbGV0IHJ4ID0gcG9pbnRzW2ldO1xuICAgIGxldCByeSA9IHBvaW50c1tpICsgMV07XG4gICAgbGV0IGFuZ2xlID0gcG9pbnRzW2kgKyAyXTtcbiAgICBsZXQgbGFyZ2VBcmMgPSBwb2ludHNbaSArIDNdO1xuICAgIGxldCBzd2VlcCA9IHBvaW50c1tpICsgNF07XG4gICAgbGV0IGVuZFggPSBwb2ludHNbaSArIDVdO1xuICAgIGxldCBlbmRZID0gcG9pbnRzW2kgKyA2XTtcbiAgICAvLyBJZiB0aGUgZW5kcG9pbnRzICh4MSwgeTEpIGFuZCAoeDIsIHkyKSBhcmUgaWRlbnRpY2FsLCB0aGVuXG4gICAgLy8gdGhpcyBpcyBlcXVpdmFsZW50IHRvIG9taXR0aW5nIHRoZSBlbGxpcHRpY2FsIGFyYyBzZWdtZW50IGVudGlyZWx5LlxuICAgIGlmIChzdGFydFg9PT1lbmRYICYmIHN0YXJ0WT09PWVuZFkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICAvLyBJZiByeCA9IDAgb3IgcnkgPSAwIHRoZW4gdGhpcyBhcmMgaXMgdHJlYXRlZCBhcyBhIHN0cmFpZ2h0XG4gICAgLy8gbGluZSBzZWdtZW50IChhIFwibGluZXRvXCIpIGpvaW5pbmcgdGhlIGVuZHBvaW50cy5cbiAgICBpZiAocng9PT0wIHx8IHJ5PT09MCkge1xuICAgICAgcHRzLnB1c2goLi4uY2FsY3VsYXRlQ29vcmRpbmF0ZXNMaW5lYXIoWyBzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSBdLCBtaW5EaXN0YW5jZSwgcm91bmRUb05lYXJlc3QsIHNhbXBsZUZyZXF1ZW5jeSkpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIC8vIElmIHJ4IG9yIHJ5IGhhdmUgbmVnYXRpdmUgc2lnbnMsIHRoZXNlIGFyZSBkcm9wcGVkO1xuICAgIC8vIHRoZSBhYnNvbHV0ZSB2YWx1ZSBpcyB1c2VkIGluc3RlYWQuXG4gICAgaWYgKHJ4IDwgMCkge1xuICAgICAgcnggKj0gLTE7XG4gICAgfVxuICAgIGlmIChyeSA8IDApIHtcbiAgICAgIHJ5ICo9IC0xO1xuICAgIH1cblxuICAgIGNvbnN0IGJlemllcnMgPSBkZWNvbXBvc2VBcmNUb0N1YmljKHsgeDogc3RhcnRYLCB5OiBzdGFydFkgfSwgYW5nbGUsIHJ4LCByeSwgbGFyZ2VBcmMsIHN3ZWVwLCB7IHg6IGVuZFgsIHk6IGVuZFkgfSk7XG4gICAgLy8gVHJpcGxldCBwb2ludHMgLSBzdGFydCBvZiBuZXcgYmV6aWVyIGlzIGVuZCBvZiBsYXN0XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiZXppZXJzLmxlbmd0aDsgaSArPSAzKSB7XG4gICAgICBjb25zdCBjdHJsUHQxID0gYmV6aWVyc1tpXTtcbiAgICAgIGNvbnN0IGN0cmxQdDIgPSBiZXppZXJzW2kgKyAxXTtcbiAgICAgIGNvbnN0IGVuZFBvaW50ID0gYmV6aWVyc1tpICsgMl07XG4gICAgICBjb25zdCBwb2ludHMgPSBbIHN0YXJ0WCwgc3RhcnRZLCBjdHJsUHQxLngsIGN0cmxQdDEueSwgY3RybFB0Mi54LCBjdHJsUHQyLnksIGVuZFBvaW50LngsIGVuZFBvaW50LnkgXTtcbiAgICAgIGNvbnN0IGludGVycG9sYXRlZFBvaW50cyA9IGNhbGN1bGF0ZUNvb3JkaW5hdGVzQ3ViaWMocG9pbnRzLCBtaW5EaXN0YW5jZSwgcm91bmRUb05lYXJlc3QsIHNhbXBsZUZyZXF1ZW5jeSk7XG4gICAgICBwdHMucHVzaCguLi5pbnRlcnBvbGF0ZWRQb2ludHMpO1xuXG4gICAgICBzdGFydFggPSBlbmRQb2ludC54O1xuICAgICAgc3RhcnRZID0gZW5kUG9pbnQueTtcbiAgICB9XG4gICAgc3RhcnRYID0gZW5kWDtcbiAgICBzdGFydFkgPSBlbmRZO1xuICB9XG5cbiAgcmV0dXJuIHB0cztcbn1cblxuZnVuY3Rpb24gZGVjb21wb3NlQXJjVG9DdWJpYyhwb2ludDE6IFBvaW50LCByb3RhdGlvbkluRGVncmVlczogbnVtYmVyLCByeDogbnVtYmVyLCByeTogbnVtYmVyLCBsYXJnZUFyY0ZsYWc6IG51bWJlciwgc3dlZXBGbGFnOiBudW1iZXIsIHBvaW50MjogUG9pbnQpOiBbUG9pbnQsIFBvaW50LCBQb2ludF0gfCBbXSB7XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vV2ViS2l0L3dlYmtpdC9ibG9iL21hc3Rlci9Tb3VyY2UvV2ViQ29yZS9zdmcvU1ZHUGF0aFBhcnNlci5jcHBcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbnZlcnNpb24gZnJvbSBlbmRwb2ludCB0byBjZW50ZXIgcGFyYW1ldGVyaXphdGlvblxuICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvU1ZHL2ltcGxub3RlLmh0bWwjQXJjQ29udmVyc2lvbkVuZHBvaW50VG9DZW50ZXJcbiAgY29uc3QgYW5nbGVSYWRzID0gZGVnVG9SYWRzKHJvdGF0aW9uSW5EZWdyZWVzKTtcbiAgY29uc3QgbWlkUG9pbnREaXN0YW5jZSA9IHsgeDogKHBvaW50MS54IC0gcG9pbnQyLngpICogLjUsIHk6IChwb2ludDEueSAtIHBvaW50Mi55KSAqIC41IH07XG4gIGNvbnN0IHRyYW5zZm9ybWVkTWlkUG9pbnQgPSByb3RhdGVQb2ludCgwLCAwLCBtaWRQb2ludERpc3RhbmNlLngsIG1pZFBvaW50RGlzdGFuY2UueSwgLWFuZ2xlUmFkcywgLWFuZ2xlUmFkcyk7XG4gIGNvbnN0IHNxdWFyZVJ4ID0gcnggKiByeDtcbiAgY29uc3Qgc3F1YXJlUnkgPSByeSAqIHJ5O1xuICBjb25zdCBzcXVhcmVYID0gdHJhbnNmb3JtZWRNaWRQb2ludC54ICogdHJhbnNmb3JtZWRNaWRQb2ludC54O1xuICBjb25zdCBzcXVhcmVZID0gdHJhbnNmb3JtZWRNaWRQb2ludC55ICogdHJhbnNmb3JtZWRNaWRQb2ludC55O1xuXG4gIC8vIENoZWNrIGlmIHRoZSByYWRpaSBhcmUgYmlnIGVub3VnaCB0byBkcmF3IHRoZSBhcmMsIHNjYWxlIHJhZGlpIGlmIG5vdC5cbiAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHL2ltcGxub3RlLmh0bWwjQXJjQ29ycmVjdGlvbk91dE9mUmFuZ2VSYWRpaVxuICBjb25zdCByYWRpaVNjYWxlID0gc3F1YXJlWCAvIHNxdWFyZVJ4ICsgc3F1YXJlWSAvIHNxdWFyZVJ5O1xuICBpZiAocmFkaWlTY2FsZSA+IDEpIHtcbiAgICBjb25zdCBzcXJ0UmFkaWlTY2FsZSA9IE1hdGguc3FydChyYWRpaVNjYWxlKTtcbiAgICByeCAqPSBzcXJ0UmFkaWlTY2FsZTtcbiAgICByeSAqPSBzcXJ0UmFkaWlTY2FsZTtcbiAgfVxuICAvLyBBcHBseSBzY2FsZVxuICBwb2ludDEgPSB7IHg6IHBvaW50MS54ICogKDEgLyByeCksIHk6IHBvaW50MS55ICogKDEgLyByeSkgfTtcbiAgcG9pbnQyID0geyB4OiBwb2ludDIueCAqICgxIC8gcngpLCB5OiBwb2ludDIueSAqICgxIC8gcnkpIH07XG4gIC8vIEFwcGx5IHJvdGF0aW9uXG4gIHBvaW50MSA9IHJvdGF0ZVBvaW50KDAsIDAsIHBvaW50MS54LCBwb2ludDEueSwgLWFuZ2xlUmFkcywgLWFuZ2xlUmFkcyk7XG4gIHBvaW50MiA9IHJvdGF0ZVBvaW50KDAsIDAsIHBvaW50Mi54LCBwb2ludDIueSwgLWFuZ2xlUmFkcywgLWFuZ2xlUmFkcyk7XG5cbiAgY29uc3QgZGVsdGEgPSB7IHg6IHBvaW50Mi54IC0gcG9pbnQxLngsIHk6IHBvaW50Mi55IC0gcG9pbnQxLnkgfTtcbiAgY29uc3QgZCA9IGRlbHRhLnggKiBkZWx0YS54ICsgZGVsdGEueSAqIGRlbHRhLnk7XG4gIGNvbnN0IHNjYWxlRmFjdG9yU3F1YXJlZCA9IE1hdGgubWF4KDEgLyBkIC0gMC4yNSwgMCk7XG4gIGxldCBzY2FsZUZhY3RvciA9IE1hdGguc3FydChzY2FsZUZhY3RvclNxdWFyZWQpO1xuICBpZiAoc3dlZXBGbGFnPT09bGFyZ2VBcmNGbGFnKSB7XG4gICAgc2NhbGVGYWN0b3IgPSAtc2NhbGVGYWN0b3I7XG4gIH1cbiAgZGVsdGEueCAqPSBzY2FsZUZhY3RvcjtcbiAgZGVsdGEueSAqPSBzY2FsZUZhY3RvcjtcbiAgbGV0IGNlbnRlclBvaW50ID0geyB4OiAocG9pbnQxLnggKyBwb2ludDIueCkgKiAuNSwgeTogKHBvaW50MS55ICsgcG9pbnQyLnkpICogLjUgfTtcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL1dlYktpdC93ZWJraXQvYmxvYi9tYXN0ZXIvU291cmNlL1dlYkNvcmUvc3ZnL1NWR1BhdGhQYXJzZXIuY3BwI0w0NjVcbiAgY2VudGVyUG9pbnQueCAtPSBkZWx0YS55O1xuICBjZW50ZXJQb2ludC55ICs9IGRlbHRhLng7XG5cbiAgY29uc3QgdGhldGExID0gTWF0aC5hdGFuMihwb2ludDEueSAtIGNlbnRlclBvaW50LnksIHBvaW50MS54IC0gY2VudGVyUG9pbnQueCk7XG4gIGNvbnN0IHRoZXRhMiA9IE1hdGguYXRhbjIocG9pbnQyLnkgLSBjZW50ZXJQb2ludC55LCBwb2ludDIueCAtIGNlbnRlclBvaW50LngpO1xuXG4gIGxldCB0aGV0YUFyYyA9IHRoZXRhMiAtIHRoZXRhMTtcbiAgaWYgKHRoZXRhQXJjIDwgMCAmJiBzd2VlcEZsYWcpXG4gICAgdGhldGFBcmMgKz0gMiAqIE1hdGguUEk7XG4gIGVsc2UgaWYgKHRoZXRhQXJjID4gMCAmJiAhc3dlZXBGbGFnKVxuICAgIHRoZXRhQXJjIC09IDIgKiBNYXRoLlBJO1xuXG4gIC8vIFNvbWUgcmVzdWx0cyBvZiBhdGFuMiBvbiBzb21lIHBsYXRmb3JtIGltcGxlbWVudGF0aW9ucyBhcmUgbm90IGV4YWN0IGVub3VnaC4gU28gdGhhdCB3ZSBnZXQgbW9yZVxuICAvLyBjdWJpYyBjdXJ2ZXMgdGhhbiBleHBlY3RlZCBoZXJlLiBBZGRpbmcgMC4wMDFmIHJlZHVjZXMgdGhlIGNvdW50IG9mIHNlZ21lbnRzIHRvIHRoZSBjb3JyZWN0IGNvdW50LlxuICBjb25zdCBjdWJpY0JlemllcnMgPSBbXTsgLy8gVHJpcGxldCBwb2ludHMgLSBBc3N1bWVzIHRoZSBzdGFydCBwb2ludCBpcyB0aGUgZW5kIHBvaW50IGZyb20gdGhlIHByZXZpb3VzIGNvbW1hbmRcbiAgY29uc3Qgc2VnbWVudHMgPSBNYXRoLmNlaWwoTWF0aC5hYnModGhldGFBcmMgLyAoKE1hdGguUEkgLyAyKSArIDAuMDAxKSkpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHNlZ21lbnRzOyBpKyspIHtcbiAgICBjb25zdCBzdGFydFRoZXRhID0gdGhldGExICsgaSAqIHRoZXRhQXJjIC8gc2VnbWVudHM7XG4gICAgY29uc3QgZW5kVGhldGEgPSB0aGV0YTEgKyAoaSArIDEpICogdGhldGFBcmMgLyBzZWdtZW50cztcbiAgICBjb25zdCB0ID0gKDggLyA2KSAqIE1hdGgudGFuKDAuMjUgKiAoZW5kVGhldGEgLSBzdGFydFRoZXRhKSk7XG4gICAgaWYgKCFpc0Zpbml0ZSh0KSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBjb25zdCBzaW5TdGFydFRoZXRhID0gTWF0aC5zaW4oc3RhcnRUaGV0YSk7XG4gICAgY29uc3QgY29zU3RhcnRUaGV0YSA9IE1hdGguY29zKHN0YXJ0VGhldGEpO1xuICAgIGNvbnN0IHNpbkVuZFRoZXRhID0gTWF0aC5zaW4oZW5kVGhldGEpO1xuICAgIGNvbnN0IGNvc0VuZFRoZXRhID0gTWF0aC5jb3MoZW5kVGhldGEpO1xuXG4gICAgcG9pbnQxID0geyB4OiBjb3NTdGFydFRoZXRhIC0gdCAqIHNpblN0YXJ0VGhldGEsIHk6IHNpblN0YXJ0VGhldGEgKyB0ICogY29zU3RhcnRUaGV0YSB9O1xuICAgIHBvaW50MS54ICs9IGNlbnRlclBvaW50Lng7XG4gICAgcG9pbnQxLnkgKz0gY2VudGVyUG9pbnQueTtcblxuICAgIGxldCB0YXJnZXRQb2ludCA9IHsgeDogY29zRW5kVGhldGEsIHk6IHNpbkVuZFRoZXRhIH07XG4gICAgdGFyZ2V0UG9pbnQueCArPSBjZW50ZXJQb2ludC54O1xuICAgIHRhcmdldFBvaW50LnkgKz0gY2VudGVyUG9pbnQueTtcblxuICAgIHBvaW50MiA9IE9iamVjdC5hc3NpZ24oe30sIHRhcmdldFBvaW50KTtcbiAgICBwb2ludDIueCArPSB0ICogc2luRW5kVGhldGE7XG4gICAgcG9pbnQyLnkgKz0gLXQgKiBjb3NFbmRUaGV0YTtcblxuICAgIC8vIHJvdGF0ZSBhbmQgc2NhbGVcbiAgICBwb2ludDEgPSByb3RhdGVQb2ludCgwLCAwLCBwb2ludDEueCwgcG9pbnQxLnksIGFuZ2xlUmFkcywgYW5nbGVSYWRzKTtcbiAgICBwb2ludDEueCAqPSByeDtcbiAgICBwb2ludDEueSAqPSByeTtcblxuICAgIHBvaW50MiA9IHJvdGF0ZVBvaW50KDAsIDAsIHBvaW50Mi54LCBwb2ludDIueSwgYW5nbGVSYWRzLCBhbmdsZVJhZHMpO1xuICAgIHBvaW50Mi54ICo9IHJ4O1xuICAgIHBvaW50Mi55ICo9IHJ5O1xuXG4gICAgdGFyZ2V0UG9pbnQgPSByb3RhdGVQb2ludCgwLCAwLCB0YXJnZXRQb2ludC54LCB0YXJnZXRQb2ludC55LCBhbmdsZVJhZHMsIGFuZ2xlUmFkcyk7XG4gICAgdGFyZ2V0UG9pbnQueCAqPSByeDtcbiAgICB0YXJnZXRQb2ludC55ICo9IHJ5O1xuXG4gICAgY3ViaWNCZXppZXJzLnB1c2gocG9pbnQxLCBwb2ludDIsIHRhcmdldFBvaW50KTtcbiAgfVxuICByZXR1cm4gY3ViaWNCZXppZXJzIGFzIFtQb2ludCwgUG9pbnQsIFBvaW50XTtcbn1cblxuZXhwb3J0IGNvbnN0IGNhbGN1bGF0b3JzID0ge1xuICBhOiBjYWxjdWxhdGVDb29yZGluYXRlc0FyYyxcbiAgYzogY2FsY3VsYXRlQ29vcmRpbmF0ZXNDdWJpYyxcbiAgaDogY2FsY3VsYXRlQ29vcmRpbmF0ZXNMaW5lYXIsXG4gIGw6IGNhbGN1bGF0ZUNvb3JkaW5hdGVzTGluZWFyLFxuICBtOiBjYWxjdWxhdGVDb29yZGluYXRlc0xpbmVhcixcbiAgcTogY2FsY3VsYXRlQ29vcmRpbmF0ZXNRdWFkLFxuICBzOiBjYWxjdWxhdGVDb29yZGluYXRlc1Ntb290aEN1YmljLFxuICB2OiBjYWxjdWxhdGVDb29yZGluYXRlc0xpbmVhcixcbiAgejogY2FsY3VsYXRlQ29vcmRpbmF0ZXNMaW5lYXJcbn07XG4iXX0=