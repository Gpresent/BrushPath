/**
 * Javascript adaptation of AffineTransform.ccp from
 * https://github.com/WebKit/webkit/blob/66e68cd8d7bf4ea1cf52f31ed9cb242f83ea5b57/Source/WebCore/platform/graphics/transforms/AffineTransform.cpp
 */
/*
 * Copyright (C) Research In Motion Limited 2010. All rights reserved.
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Library General Public
 * License as published by the Free Software Foundation; either
 * version 2 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Library General Public License for more details.
 *
 * You should have received a copy of the GNU Library General Public License
 * along with this library; see the file COPYING.LIB.  If not, write to
 * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
 * Boston, MA 02110-1301, USA.
 */
/*
 * Copyright (C) 2005, 2006 Apple Inc.  All rights reserved.
 *               2010 Dirk Schulze <krit@webkit.org>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
import { degToRads, radToDeg } from './utils.js';
export class SVGTransform {
    m_transform;
    constructor(a = 1, b = 0, c = 0, d = 1, e = 0, f = 0) {
        this.m_transform = [+a, +b, +c, +d, +e, +f];
    }
    makeIdentity() {
        this.setMatrix(1, 0, 0, 1, 0, 0);
    }
    setMatrix(a = 1, b = 0, c = 0, d = 1, e = 0, f = 0) {
        const m_transform = this.m_transform;
        m_transform[0] = +a;
        m_transform[1] = +b;
        m_transform[2] = +c;
        m_transform[3] = +d;
        m_transform[4] = +e;
        m_transform[5] = +f;
    }
    matrix(a = 1, b = 0, c = 0, d = 1, e = 0, f = 0) {
        this.setMatrix(a, b, c, d, e, f);
    }
    isIdentity() {
        const m_transform = this.m_transform;
        return (m_transform[0] === 1 && m_transform[1] === 0
            && m_transform[2] === 0 && m_transform[3] === 1
            && m_transform[4] === 0 && m_transform[5] === 0);
    }
    static det(transform) {
        return +(transform[0] * transform[3] - transform[1] * transform[2]);
    }
    get xScale() {
        const m_transform = this.m_transform;
        return Math.sqrt(m_transform[0] * m_transform[0] + m_transform[1] * m_transform[1]);
    }
    get yScale() {
        const m_transform = this.m_transform;
        return Math.sqrt(m_transform[2] * m_transform[2] + m_transform[3] * m_transform[3]);
    }
    get isInvertible() {
        const determinant = SVGTransform.det(this.m_transform);
        return Boolean(determinant && isFinite(determinant));
    }
    inverse() {
        const m_transform = this.m_transform;
        const determinant = SVGTransform.det(m_transform);
        const result = new SVGTransform();
        if (this.isIdentityOrTranslation()) {
            result.m_transform[4] = -m_transform[4];
            result.m_transform[5] = -m_transform[5];
            return result;
        }
        result.m_transform[0] = m_transform[3] / determinant;
        result.m_transform[1] = -m_transform[1] / determinant;
        result.m_transform[2] = -m_transform[2] / determinant;
        result.m_transform[3] = m_transform[0] / determinant;
        result.m_transform[4] = (m_transform[2] * m_transform[5] - m_transform[3] * m_transform[4]) / determinant;
        result.m_transform[5] = (m_transform[1] * m_transform[4] - m_transform[0] * m_transform[5]) / determinant;
        return result;
    }
    isIdentityOrTranslation() {
        const m_transform = this.m_transform;
        return m_transform[0] === 1 && m_transform[1] === 0 && m_transform[2] === 0 && m_transform[3] === 1;
    }
    multiply(other) {
        const m_transform = this.m_transform;
        const trans = new SVGTransform();
        const om_transform = other.m_transform;
        const tm_transform = trans.m_transform;
        tm_transform[0] = om_transform[0] * m_transform[0] + om_transform[1] * m_transform[2];
        tm_transform[1] = om_transform[0] * m_transform[1] + om_transform[1] * m_transform[3];
        tm_transform[2] = om_transform[2] * m_transform[0] + om_transform[3] * m_transform[2];
        tm_transform[3] = om_transform[2] * m_transform[1] + om_transform[3] * m_transform[3];
        tm_transform[4] = om_transform[4] * m_transform[0] + om_transform[5] * m_transform[2] + m_transform[4];
        tm_transform[5] = om_transform[4] * m_transform[1] + om_transform[5] * m_transform[3] + m_transform[5];
        this.m_transform = trans.m_transform;
        return this;
    }
    rotate(degrees, x, y) {
        const translateFlag = Boolean(x !== undefined && y !== undefined);
        if (translateFlag) {
            this.translate(x, y);
        }
        const rads = degToRads(degrees);
        const cosAngle = Math.cos(rads);
        const sinAngle = Math.sin(rads);
        const rot = new SVGTransform(cosAngle, sinAngle, -sinAngle, cosAngle, 0, 0);
        this.multiply(rot);
        if (translateFlag) {
            this.translate(-x, -y);
        }
        return this;
    }
    scale(sx, sy) {
        const m_transform = this.m_transform;
        if (sy === undefined) {
            sy = sx;
        }
        m_transform[0] *= sx;
        m_transform[1] *= sx;
        m_transform[2] *= sy;
        m_transform[3] *= sy;
        return this;
    }
    translate(tx, ty) {
        const m_transform = this.m_transform;
        if (this.isIdentityOrTranslation()) {
            m_transform[4] += tx;
            m_transform[5] += ty;
            return this;
        }
        m_transform[4] += tx * m_transform[0] + ty * m_transform[2];
        m_transform[5] += tx * m_transform[1] + ty * m_transform[3];
        return this;
    }
    rotateFromVector(x, y) {
        return this.rotate(radToDeg(Math.atan2(y, x)), x, y);
    }
    flipX() {
        return this.scale(-1, 1);
    }
    flipY() {
        return this.scale(1, -1);
    }
    shear(sx, sy) {
        const m_transform = this.m_transform;
        const a = m_transform[0];
        const b = m_transform[1];
        m_transform[0] += sy * m_transform[2];
        m_transform[1] += sy * m_transform[3];
        m_transform[2] += sx * a;
        m_transform[3] += sx * b;
        return this;
    }
    skew(angleX, angleY) {
        return this.shear(Math.tan(degToRads(angleX)), Math.tan(degToRads(angleY)));
    }
    skewX(angle) {
        return this.shear(Math.tan(degToRads(angle)), 0);
    }
    skewY(angle) {
        return this.shear(0, Math.tan(degToRads(angle)));
    }
    map(x, y) {
        const m_transform = this.m_transform;
        return {
            x: (m_transform[0] * x + m_transform[2] * y + m_transform[4]),
            y: (m_transform[1] * x + m_transform[3] * y + m_transform[5])
        };
    }
    mapPoint(point) {
        return this.map(point.x, point.y);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU1ZHVHJhbnNmb3JtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21hdGgvU1ZHVHJhbnNmb3JtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRztBQUNIOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUNIOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F3Qkc7QUFDSCxPQUFPLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUdqRCxNQUFNLE9BQU8sWUFBWTtJQUViLFdBQVcsQ0FBVztJQUVoQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQztRQUNsRCxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUUsQ0FBQztJQUNoRCxDQUFDO0lBRUQsWUFBWTtRQUNWLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQztRQUNoRCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ3JDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNwQixXQUFXLENBQUMsQ0FBQyxDQUFDLEdB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LE1BQU0sQ0FBQztTQUNmO1FBRUQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDO1FBQ3JELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDO1FBQ3RELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDO1FBQ3RELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQztRQUNyRCxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDO1FBQzFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUM7UUFFMUcsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVELHVCQUF1QjtRQUNyQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ3JDLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxLQUFHLENBQUMsSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLEtBQUcsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUMsS0FBRyxDQUFDLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQyxLQUFHLENBQUMsQ0FBQztJQUM5RixDQUFDO0lBRUQsUUFBUSxDQUFDLEtBQW1CO1FBQzFCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDckMsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNqQyxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDO1FBQ3ZDLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUM7UUFFdkMsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0RixZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RGLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEYsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0RixZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2RyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxD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RSxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELEdBQUcsQ0FBQyxDQUFTLEVBQUUsQ0FBUztRQUN0QixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ3JDLE9BQU87WUFDTCxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdELENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDOUQsQ0FBQTtJQUNILENBQUM7SUFFRCxRQUFRLENBQUMsS0FBWTtRQUNuQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEphdmFzY3JpcHQgYWRhcHRhdGlvbiBvZiBBZmZpbmVUcmFuc2Zvcm0uY2NwIGZyb21cclxuICogaHR0cHM6Ly9naXRodWIuY29tL1dlYktpdC93ZWJraXQvYmxvYi82NmU2OGNkOGQ3YmY0ZWExY2Y1MmYzMWVkOWNiMjQyZjgzZWE1YjU3L1NvdXJjZS9XZWJDb3JlL3BsYXRmb3JtL2dyYXBoaWNzL3RyYW5zZm9ybXMvQWZmaW5lVHJhbnNmb3JtLmNwcFxyXG4gKi9cclxuLypcclxuICogQ29weXJpZ2h0IChDKSBSZXNlYXJjaCBJbiBNb3Rpb24gTGltaXRlZCAyMDEwLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKlxyXG4gKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yXHJcbiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMaWJyYXJ5IEdlbmVyYWwgUHVibGljXHJcbiAqIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlclxyXG4gKiB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXHJcbiAqXHJcbiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxyXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxyXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVVxyXG4gKiBMaWJyYXJ5IEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cclxuICpcclxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExpYnJhcnkgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxyXG4gKiBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgc2VlIHRoZSBmaWxlIENPUFlJTkcuTElCLiAgSWYgbm90LCB3cml0ZSB0b1xyXG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLFxyXG4gKiBCb3N0b24sIE1BIDAyMTEwLTEzMDEsIFVTQS5cclxuICovXHJcbi8qXHJcbiAqIENvcHlyaWdodCAoQykgMjAwNSwgMjAwNiBBcHBsZSBJbmMuICBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4gKiAgICAgICAgICAgICAgIDIwMTAgRGlyayBTY2h1bHplIDxrcml0QHdlYmtpdC5vcmc+XHJcbiAqXHJcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxyXG4gKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnNcclxuICogYXJlIG1ldDpcclxuICogMS4gUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHRcclxuICogICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxyXG4gKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodFxyXG4gKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlXHJcbiAqICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXHJcbiAqXHJcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgQVBQTEUgSU5DLiBgYEFTIElTJycgQU5EIEFOWVxyXG4gKiBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRVxyXG4gKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVJcclxuICogUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gIElOIE5PIEVWRU5UIFNIQUxMIEFQUExFIElOQy4gT1JcclxuICogQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsXHJcbiAqIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTyxcclxuICogUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SXHJcbiAqIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUllcclxuICogT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXHJcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRVxyXG4gKiBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLlxyXG4gKi9cclxuaW1wb3J0IHsgZGVnVG9SYWRzLCByYWRUb0RlZyB9IGZyb20gJy4vdXRpbHMuanMnO1xyXG5pbXBvcnQgdHlwZSB7IFBvaW50IH0gZnJvbSAnLi9jYWxjdWxhdG9ycyc7XHJcblxyXG5leHBvcnQgY2xhc3MgU1ZHVHJhbnNmb3JtIHtcclxuXHJcbiAgcHJvdGVjdGVkIG1fdHJhbnNmb3JtOiBudW1iZXJbXTtcclxuXHJcbiAgY29uc3RydWN0b3IoYSA9IDEsIGIgPSAwLCBjID0gMCwgZCA9IDEsIGUgPSAwLCBmID0gMCkge1xyXG4gICAgdGhpcy5tX3RyYW5zZm9ybSA9IFsgK2EsICtiLCArYywgK2QsICtlLCArZiBdO1xyXG4gIH1cclxuXHJcbiAgbWFrZUlkZW50aXR5KCkge1xyXG4gICAgdGhpcy5zZXRNYXRyaXgoMSwgMCwgMCwgMSwgMCwgMCk7XHJcbiAgfVxyXG5cclxuICBzZXRNYXRyaXgoYSA9IDEsIGIgPSAwLCBjID0gMCwgZCA9IDEsIGUgPSAwLCBmID0gMCkge1xyXG4gICAgY29uc3QgbV90cmFuc2Zvcm0gPSB0aGlzLm1fdHJhbnNmb3JtO1xyXG4gICAgbV90cmFuc2Zvcm1bMF0gPSArYTtcclxuICAgIG1fdHJhbnNmb3JtWzFdID0gK2I7XHJcbiAgICBtX3RyYW5zZm9ybVsyXSA9ICtjO1xyXG4gICAgbV90cmFuc2Zvcm1bM10gPSArZDtcclxuICAgIG1fdHJhbnNmb3JtWzRdID0gK2U7XHJcbiAgICBtX3RyYW5zZm9ybVs1XSA9ICtmO1xyXG4gIH1cclxuXHJcbiAgbWF0cml4KGEgPSAxLCBiID0gMCwgYyA9IDAsIGQgPSAxLCBlID0gMCwgZiA9IDApIHtcclxuICAgIHRoaXMuc2V0TWF0cml4KGEsIGIsIGMsIGQsIGUsIGYpO1xyXG4gIH1cclxuXHJcbiAgaXNJZGVudGl0eSgpIHtcclxuICAgIGNvbnN0IG1fdHJhbnNmb3JtID0gdGhpcy5tX3RyYW5zZm9ybTtcclxuXHJcbiAgICByZXR1cm4gKG1fdHJhbnNmb3JtWzBdPT09MSAmJiBtX3RyYW5zZm9ybVsxXT09PTBcclxuICAgICAgICAmJiBtX3RyYW5zZm9ybVsyXT09PTAgJiYgbV90cmFuc2Zvcm1bM109PT0xXHJcbiAgICAgICAgJiYgbV90cmFuc2Zvcm1bNF09PT0wICYmIG1fdHJhbnNmb3JtWzVdPT09MCk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZGV0KHRyYW5zZm9ybTogbnVtYmVyW10pIHtcclxuICAgIHJldHVybiArKHRyYW5zZm9ybVswXSAqIHRyYW5zZm9ybVszXSAtIHRyYW5zZm9ybVsxXSAqIHRyYW5zZm9ybVsyXSk7XHJcbiAgfVxyXG5cclxuICBnZXQgeFNjYWxlKCkge1xyXG4gICAgY29uc3QgbV90cmFuc2Zvcm0gPSB0aGlzLm1fdHJhbnNmb3JtO1xyXG5cclxuICAgIHJldHVybiBNYXRoLnNxcnQobV90cmFuc2Zvcm1bMF0gKiBtX3RyYW5zZm9ybVswXSArIG1fdHJhbnNmb3JtWzFdICogbV90cmFuc2Zvcm1bMV0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHlTY2FsZSgpIHtcclxuICAgIGNvbnN0IG1fdHJhbnNmb3JtID0gdGhpcy5tX3RyYW5zZm9ybTtcclxuICAgIHJldHVybiBNYXRoLnNxcnQobV90cmFuc2Zvcm1bMl0gKiBtX3RyYW5zZm9ybVsyXSArIG1fdHJhbnNmb3JtWzNdICogbV90cmFuc2Zvcm1bM10pO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzSW52ZXJ0aWJsZSgpIHtcclxuICAgIGNvbnN0IGRldGVybWluYW50ID0gU1ZHVHJhbnNmb3JtLmRldCh0aGlzLm1fdHJhbnNmb3JtKTtcclxuICAgIHJldHVybiBCb29sZWFuKGRldGVybWluYW50ICYmIGlzRmluaXRlKGRldGVybWluYW50KSk7XHJcbiAgfVxyXG5cclxuICBpbnZlcnNlKCkge1xyXG4gICAgY29uc3QgbV90cmFuc2Zvcm0gPSB0aGlzLm1fdHJhbnNmb3JtO1xyXG4gICAgY29uc3QgZGV0ZXJtaW5hbnQgPSBTVkdUcmFuc2Zvcm0uZGV0KG1fdHJhbnNmb3JtKTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBTVkdUcmFuc2Zvcm0oKTtcclxuICAgIGlmICh0aGlzLmlzSWRlbnRpdHlPclRyYW5zbGF0aW9uKCkpIHtcclxuICAgICAgcmVzdWx0Lm1fdHJhbnNmb3JtWzRdID0gLW1fdHJhbnNmb3JtWzRdO1xyXG4gICAgICByZXN1bHQubV90cmFuc2Zvcm1bNV0gPSAtbV90cmFuc2Zvcm1bNV07XHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzdWx0Lm1fdHJhbnNmb3JtWzBdID0gbV90cmFuc2Zvcm1bM10gLyBkZXRlcm1pbmFudDtcclxuICAgIHJlc3VsdC5tX3RyYW5zZm9ybVsxXSA9IC1tX3RyYW5zZm9ybVsxXSAvIGRldGVybWluYW50O1xyXG4gICAgcmVzdWx0Lm1fdHJhbnNmb3JtWzJdID0gLW1fdHJhbnNmb3JtWzJdIC8gZGV0ZXJtaW5hbnQ7XHJcbiAgICByZXN1bHQubV90cmFuc2Zvcm1bM10gPSBtX3RyYW5zZm9ybVswXSAvIGRldGVybWluYW50O1xyXG4gICAgcmVzdWx0Lm1fdHJhbnNmb3JtWzRdID0gKG1fdHJhbnNmb3JtWzJdICogbV90cmFuc2Zvcm1bNV0gLSBtX3RyYW5zZm9ybVszXSAqIG1fdHJhbnNmb3JtWzRdKSAvIGRldGVybWluYW50O1xyXG4gICAgcmVzdWx0Lm1fdHJhbnNmb3JtWzVdID0gKG1fdHJhbnNmb3JtWzFdICogbV90cmFuc2Zvcm1bNF0gLSBtX3RyYW5zZm9ybVswXSAqIG1fdHJhbnNmb3JtWzVdKSAvIGRldGVybWluYW50O1xyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICBpc0lkZW50aXR5T3JUcmFuc2xhdGlvbigpIHtcclxuICAgIGNvbnN0IG1fdHJhbnNmb3JtID0gdGhpcy5tX3RyYW5zZm9ybTtcclxuICAgIHJldHVybiBtX3RyYW5zZm9ybVswXT09PTEgJiYgbV90cmFuc2Zvcm1bMV09PT0wICYmIG1fdHJhbnNmb3JtWzJdPT09MCAmJiBtX3RyYW5zZm9ybVszXT09PTE7XHJcbiAgfVxyXG5cclxuICBtdWx0aXBseShvdGhlcjogU1ZHVHJhbnNmb3JtKSB7XHJcbiAgICBjb25zdCBtX3RyYW5zZm9ybSA9IHRoaXMubV90cmFuc2Zvcm07XHJcbiAgICBjb25zdCB0cmFucyA9IG5ldyBTVkdUcmFuc2Zvcm0oKTtcclxuICAgIGNvbnN0IG9tX3RyYW5zZm9ybSA9IG90aGVyLm1fdHJhbnNmb3JtO1xyXG4gICAgY29uc3QgdG1fdHJhbnNmb3JtID0gdHJhbnMubV90cmFuc2Zvcm07XHJcblxyXG4gICAgdG1fdHJhbnNmb3JtWzBdID0gb21fdHJhbnNmb3JtWzBdICogbV90cmFuc2Zvcm1bMF0gKyBvbV90cmFuc2Zvcm1bMV0gKiBtX3RyYW5zZm9ybVsyXTtcclxuICAgIHRtX3RyYW5zZm9ybVsxXSA9IG9tX3RyYW5zZm9ybVswXSAqIG1fdHJhbnNmb3JtWzFdICsgb21fdHJhbnNmb3JtWzFdICogbV90cmFuc2Zvcm1bM107XHJcbiAgICB0bV90cmFuc2Zvcm1bMl0gPSBvbV90cmFuc2Zvcm1bMl0gKiBtX3RyYW5zZm9ybVswXSArIG9tX3RyYW5zZm9ybVszXSAqIG1fdHJhbnNmb3JtWzJdO1xyXG4gICAgdG1fdHJhbnNmb3JtWzNdID0gb21fdHJhbnNmb3JtWzJdICogbV90cmFuc2Zvcm1bMV0gKyBvbV90cmFuc2Zvcm1bM10gKiBtX3RyYW5zZm9ybVszXTtcclxuICAgIHRtX3RyYW5zZm9ybVs0XSA9IG9tX3RyYW5zZm9ybVs0XSAqIG1fdHJhbnNmb3JtWzBdICsgb21fdHJhbnNmb3JtWzVdICogbV90cmFuc2Zvcm1bMl0gKyBtX3RyYW5zZm9ybVs0XTtcclxuICAgIHRtX3RyYW5zZm9ybVs1XSA9IG9tX3RyYW5zZm9ybVs0XSAqIG1fdHJhbnNmb3JtWzFdICsgb21fdHJhbnNmb3JtWzVdICogbV90cmFuc2Zvcm1bM10gKyBtX3RyYW5zZm9ybVs1XTtcclxuXHJcbiAgICB0aGlzLm1fdHJhbnNmb3JtID0gdHJhbnMubV90cmFuc2Zvcm07XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHJvdGF0ZShkZWdyZWVzOiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICBjb25zdCB0cmFuc2xhdGVGbGFnID0gQm9vbGVhbih4IT09dW5kZWZpbmVkICYmIHkhPT11bmRlZmluZWQpO1xyXG4gICAgaWYgKHRyYW5zbGF0ZUZsYWcpIHtcclxuICAgICAgdGhpcy50cmFuc2xhdGUoeCwgeSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByYWRzID0gZGVnVG9SYWRzKGRlZ3JlZXMpO1xyXG4gICAgY29uc3QgY29zQW5nbGUgPSBNYXRoLmNvcyhyYWRzKTtcclxuICAgIGNvbnN0IHNpbkFuZ2xlID0gTWF0aC5zaW4ocmFkcyk7XHJcbiAgICBjb25zdCByb3QgPSBuZXcgU1ZHVHJhbnNmb3JtKGNvc0FuZ2xlLCBzaW5BbmdsZSwgLXNpbkFuZ2xlLCBjb3NBbmdsZSwgMCwgMCk7XHJcblxyXG4gICAgdGhpcy5tdWx0aXBseShyb3QpO1xyXG5cclxuICAgIGlmICh0cmFuc2xhdGVGbGFnKSB7XHJcbiAgICAgIHRoaXMudHJhbnNsYXRlKC14LCAteSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHNjYWxlKHN4OiBudW1iZXIsIHN5OiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG1fdHJhbnNmb3JtID0gdGhpcy5tX3RyYW5zZm9ybTtcclxuICAgIGlmIChzeT09PXVuZGVmaW5lZCkge1xyXG4gICAgICBzeSA9IHN4O1xyXG4gICAgfVxyXG4gICAgbV90cmFuc2Zvcm1bMF0gKj0gc3g7XHJcbiAgICBtX3RyYW5zZm9ybVsxXSAqPSBzeDtcclxuICAgIG1fdHJhbnNmb3JtWzJdICo9IHN5O1xyXG4gICAgbV90cmFuc2Zvcm1bM10gKj0gc3k7XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICB0cmFuc2xhdGUodHg6IG51bWJlciwgdHk6IG51bWJlcikge1xyXG4gICAgY29uc3QgbV90cmFuc2Zvcm0gPSB0aGlzLm1fdHJhbnNmb3JtO1xyXG4gICAgaWYgKHRoaXMuaXNJZGVudGl0eU9yVHJhbnNsYXRpb24oKSkge1xyXG4gICAgICBtX3RyYW5zZm9ybVs0XSArPSB0eDtcclxuICAgICAgbV90cmFuc2Zvcm1bNV0gKz0gdHk7XHJcbiAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIG1fdHJhbnNmb3JtWzRdICs9IHR4ICogbV90cmFuc2Zvcm1bMF0gKyB0eSAqIG1fdHJhbnNmb3JtWzJdO1xyXG4gICAgbV90cmFuc2Zvcm1bNV0gKz0gdHggKiBtX3RyYW5zZm9ybVsxXSArIHR5ICogbV90cmFuc2Zvcm1bM107XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHJvdGF0ZUZyb21WZWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcclxuICAgIHJldHVybiB0aGlzLnJvdGF0ZShyYWRUb0RlZyhNYXRoLmF0YW4yKHksIHgpKSwgeCwgeSk7XHJcbiAgfVxyXG5cclxuICBmbGlwWCgpIHtcclxuICAgIHJldHVybiB0aGlzLnNjYWxlKC0xLCAxKTtcclxuICB9XHJcblxyXG4gIGZsaXBZKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuc2NhbGUoMSwgLTEpO1xyXG4gIH1cclxuXHJcbiAgc2hlYXIoc3g6IG51bWJlciwgc3k6IG51bWJlcikge1xyXG4gICAgY29uc3QgbV90cmFuc2Zvcm0gPSB0aGlzLm1fdHJhbnNmb3JtO1xyXG4gICAgY29uc3QgYSA9IG1fdHJhbnNmb3JtWzBdO1xyXG4gICAgY29uc3QgYiA9IG1fdHJhbnNmb3JtWzFdO1xyXG5cclxuICAgIG1fdHJhbnNmb3JtWzBdICs9IHN5ICogbV90cmFuc2Zvcm1bMl07XHJcbiAgICBtX3RyYW5zZm9ybVsxXSArPSBzeSAqIG1fdHJhbnNmb3JtWzNdO1xyXG4gICAgbV90cmFuc2Zvcm1bMl0gKz0gc3ggKiBhO1xyXG4gICAgbV90cmFuc2Zvcm1bM10gKz0gc3ggKiBiO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBza2V3KGFuZ2xlWDogbnVtYmVyLCBhbmdsZVk6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuc2hlYXIoTWF0aC50YW4oZGVnVG9SYWRzKGFuZ2xlWCkpLCBNYXRoLnRhbihkZWdUb1JhZHMoYW5nbGVZKSkpO1xyXG4gIH1cclxuXHJcbiAgc2tld1goYW5nbGU6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuc2hlYXIoTWF0aC50YW4oZGVnVG9SYWRzKGFuZ2xlKSksIDApO1xyXG4gIH1cclxuXHJcbiAgc2tld1koYW5nbGU6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuc2hlYXIoMCwgTWF0aC50YW4oZGVnVG9SYWRzKGFuZ2xlKSkpO1xyXG4gIH1cclxuXHJcbiAgbWFwKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBtX3RyYW5zZm9ybSA9IHRoaXMubV90cmFuc2Zvcm07XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiAobV90cmFuc2Zvcm1bMF0gKiB4ICsgbV90cmFuc2Zvcm1bMl0gKiB5ICsgbV90cmFuc2Zvcm1bNF0pLFxyXG4gICAgICB5OiAobV90cmFuc2Zvcm1bMV0gKiB4ICsgbV90cmFuc2Zvcm1bM10gKiB5ICsgbV90cmFuc2Zvcm1bNV0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBtYXBQb2ludChwb2ludDogUG9pbnQpIHtcclxuICAgIHJldHVybiB0aGlzLm1hcChwb2ludC54LCBwb2ludC55KTtcclxuICB9XHJcbn1cclxuIl19